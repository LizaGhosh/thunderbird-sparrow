<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure System - Voice Note Parser</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .config-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-microphone-alt me-2"></i>
                Sparrow Dev Test
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/"><i class="fas fa-home me-1"></i>Home</a>
                <a class="nav-link" href="/run_tests"><i class="fas fa-play me-1"></i>Run Tests</a>
                <a class="nav-link" href="/results"><i class="fas fa-chart-bar me-1"></i>Results</a>
                <a class="nav-link" href="/voice_record"><i class="fas fa-microphone me-1"></i>Voice Record</a>

            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="alert alert-info text-center mb-4">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Unified Configuration:</strong> These settings apply to both test execution and voice processing
                </div>
                <div class="card config-card">
                    <div class="card-header text-center">
                        <h3><i class="fas fa-cog me-2"></i>System Configuration</h3>
                        <p class="text-muted mb-0">Configure AI model parameters for both testing and voice processing</p>
                    </div>
                    <div class="card-body">
                        {% if error %}
                        <div class="alert alert-danger" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            {{ error }}
                        </div>
                        {% endif %}

                        <form method="POST" action="/configure">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="ai_provider" class="form-label">
                                        <i class="fas fa-robot me-1"></i>AI Provider
                                    </label>
                                    <select class="form-select" id="ai_provider" name="ai_provider" required>
                                        <option value="claude" {% if config and config.ai_provider == 'claude' %}selected{% endif %}>Anthropic Claude</option>
                                        <option value="gemini" {% if config and config.ai_provider == 'gemini' %}selected{% endif %}>Google Gemini</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="model" class="form-label">
                                        <i class="fas fa-brain me-1"></i>Model
                                    </label>
                                    <select class="form-select" id="model" name="model" required>
                                        <option value="claude-3-5-sonnet-20241022" {% if config and config.model == 'claude-3-5-sonnet-20241022' %}selected{% endif %}>Claude 3.5 Sonnet</option>
                                        <option value="claude-3-opus-20240229" {% if config and config.model == 'claude-3-opus-20240229' %}selected{% endif %}>Claude 3 Opus</option>
                                        <option value="gemini-1.5-pro" {% if config and config.model == 'gemini-1.5-pro' %}selected{% endif %}>Gemini 1.5 Pro</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="temperature" class="form-label">
                                        <i class="fas fa-thermometer-half me-1"></i>Temperature
                                    </label>
                                    <input type="range" class="form-range" id="temperature" name="temperature" 
                                           min="0.0" max="1.0" step="0.05" 
                                           value="{{ config.temperature if config else 0.0 }}"
                                           oninput="tempValue.textContent = this.value">
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">Deterministic (0.0)</small>
                                        <small class="text-muted">Creative (1.0)</small>
                                    </div>
                                    <div class="text-center mt-2">
                                        <span class="badge bg-primary" id="tempValue">{{ config.temperature if config else 0.0 }}</span>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h6 class="card-title">
                                                <i class="fas fa-info-circle me-1"></i>Temperature Guide
                                            </h6>
                                            <ul class="list-unstyled mb-0 small">
                                                <li><strong>0.0:</strong> Most consistent, deterministic</li>
                                                <li><strong>0.1-0.3:</strong> Balanced, reliable</li>
                                                <li><strong>0.4-0.7:</strong> More creative, varied</li>
                                                <li><strong>0.8-1.0:</strong> Highly creative, unpredictable</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-4">
                                <div class="col-12 text-center">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-save me-2"></i>
                                        Save Configuration & Continue
                                    </button>
                                </div>
                            </div>
                        </form>
                        
                        <!-- Run Test Button (shown after redirect from run_tests page) -->
                        {% if request.args.get('redirect') == 'run_tests' %}
                        <div class="row mt-3">
                            <div class="col-12 text-center">
                                <div class="alert alert-success">
                                    <i class="fas fa-check-circle me-2"></i>
                                    <strong>Configuration saved!</strong> You can now run your test.
                                </div>
                                <a href="/run_tests" class="btn btn-success btn-lg">
                                    <i class="fas fa-play me-2"></i>
                                    Go to Run Tests
                                </a>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="card config-card mt-4">
                    <div class="card-header">
                        <h5><i class="fas fa-lightbulb me-2"></i>Configuration Tips</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>For Production Use:</h6>
                                <ul class="small">
                                    <li>Use <strong>Claude 3 Opus</strong> for highest accuracy</li>
                                    <li>Set temperature to <strong>0.0-0.1</strong> for consistency</li>
                                    <li>Ensure API keys are properly configured</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>For Testing/Development:</h6>
                                <ul class="small">
                                    <li>Use <strong>Claude 3.5 Sonnet</strong> for cost efficiency</li>
                                    <li>Try different temperatures to see impact</li>
                                    <li>Test with both short and full datasets</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Update model options based on AI provider selection
        document.getElementById('ai_provider').addEventListener('change', function() {
            const modelSelect = document.getElementById('model');
            const provider = this.value;
            
            // Clear current options
            modelSelect.innerHTML = '';
            
            if (provider === 'claude') {
                modelSelect.innerHTML = `
                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                    <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                `;
            } else if (provider === 'gemini') {
                modelSelect.innerHTML = `
                    <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                `;
            }
        });
    </script>
</body>
</html>
